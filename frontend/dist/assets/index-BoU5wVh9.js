(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))S(f);new MutationObserver(f=>{for(const w of f)if(w.type==="childList")for(const y of w.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&S(y)}).observe(document,{childList:!0,subtree:!0});function m(f){const w={};return f.integrity&&(w.integrity=f.integrity),f.referrerPolicy&&(w.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?w.credentials="include":f.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function S(f){if(f.ep)return;f.ep=!0;const w=m(f);fetch(f.href,w)}})();function ue(g){const{container:e,graph:m,onGotoScene:S,onPathPlay:f,onGraphChange:w}=g||{};let y=re(m||{nodes:[],edges:[]}),$=null,v=!1,q=!1;try{v=JSON.parse(localStorage.getItem("minimap_locked")||"false")}catch{}v&&e.classList.add("locked"),e.classList.add("minimap"),e.innerHTML=`
      <div class="mm-toolbar">
        <div class="mm-route">
          <select id="mmFrom"></select>
          <span>→</span>
          <select id="mmTo"></select>
          <button id="mmGo">Tìm đường</button>
          <button id="mmClear">Xóa</button>
          <button id="mmUnclump">Sắp xếp</button>
        </div>
        <button class="mm-toggle" id="mmToggle">Thu</button>
      </div>
      <div class="mm-viewport" id="mmViewport">
        <div class="mm-stage" id="mmStage"></div>
        <div class="mm-zoom">
          <button id="mmZoomIn">+</button>
          <button id="mmZoomOut">−</button>
          <button id="mmZoomReset">100%</button>
          <button id="mmLock" class="mm-btn-lock">Khoá</button>
        </div>
      </div>
    `;const E=e.querySelector("#mmStage"),N=e.querySelector("#mmViewport"),I=e.querySelector("#mmFrom"),X=e.querySelector("#mmTo");let T={scale:.9,ox:0,oy:0};const D=.5,_=2.5,B=.15;function F(){E.style.transform=`translate(${T.ox}px, ${T.oy}px) scale(${T.scale})`}function K(o,i,r){const l=T.scale,p=me(l+o,D,_);if(p===l)return;const k=N.getBoundingClientRect(),n=i-k.left,t=r-k.top;T.ox=n-(n-T.ox)*(p/l),T.oy=t-(t-T.oy)*(p/l),T.scale=p,F()}function H(o,i){T.ox+=o,T.oy+=i,F()}function G(){T={scale:1,ox:0,oy:0},F()}function U(o,i){const r=N.getBoundingClientRect(),l=(o-r.left-T.ox)/T.scale,p=(i-r.top-T.oy)/T.scale;return{x:l,y:p}}function J(o){var i;v=!!o,e.classList.toggle("locked",v),(i=document.getElementById("mmLock"))==null||i.classList.toggle("active",v);try{localStorage.setItem("minimap_locked",JSON.stringify(v))}catch{}}const x=e.querySelector("#mmLock");x==null||x.addEventListener("click",()=>J(!v)),x==null||x.classList.toggle("active",v),function(){let i=null,r=0;function l(t,s,d){q=!0,i=t,e.classList.add("minimap--dragging"),p(s,d)}function p(t,s){if(!i)return;const{x:d,y:u}=U(t,s),c=Y(y,i);if(!c)return;c.x=Math.round(d),c.y=Math.round(u);const L=E.querySelector(`.mm-dot[data-id="${se(i)}"]`),M=L?L.nextElementSibling:null;L&&(L.style.left=c.x+"px",L.style.top=c.y+"px"),M&&M.classList.contains("mm-label")&&(M.style.left=c.x+10+"px",M.style.top=c.y-6+"px"),r||(r=requestAnimationFrame(()=>{r=0,n()}))}function k(){if(i){i=null,q=!1,e.classList.remove("minimap--dragging");try{localStorage.setItem("graph_draft",JSON.stringify(y))}catch{}w&&w(y)}}E.addEventListener("mousedown",t=>{const s=t.target.closest(".mm-dot");s&&(t.preventDefault(),t.stopPropagation(),l(s.dataset.id,t.clientX,t.clientY))}),window.addEventListener("mousemove",t=>{i&&p(t.clientX,t.clientY)}),window.addEventListener("mouseup",k),E.addEventListener("touchstart",t=>{if(t.touches.length!==1)return;const s=t.target.closest(".mm-dot");if(!s)return;t.preventDefault();const d=t.touches[0];l(s.dataset.id,d.clientX,d.clientY)},{passive:!1}),window.addEventListener("touchmove",t=>{if(!i||t.touches.length!==1)return;const s=t.touches[0];t.preventDefault(),p(s.clientX,s.clientY)},{passive:!1}),window.addEventListener("touchend",k,{passive:!0});function n(){E.querySelectorAll(".mm-edge").forEach(t=>t.remove());for(const t of y.edges){const s=Y(y,t.from),d=Y(y,t.to);if(!s||!d)continue;const u=document.createElement("div");u.className="mm-edge",h(u,s,d),E.insertBefore(u,E.firstChild)}}}(),N.addEventListener("wheel",o=>{o.preventDefault();const i=o.deltaY>0?-B:B;K(i,o.clientX,o.clientY)},{passive:!1}),function(){let i=!1,r=0,l=0;N.addEventListener("mousedown",p=>{v||q||p.target.closest(".mm-dot")||(i=!0,r=p.clientX,l=p.clientY)}),window.addEventListener("mousemove",p=>{i&&(H(p.clientX-r,p.clientY-l),r=p.clientX,l=p.clientY)}),window.addEventListener("mouseup",()=>i=!1),N.addEventListener("touchstart",p=>{if(v||q||p.touches.length!==1||p.target.closest(".mm-dot"))return;const k=p.touches[0];i=!0,r=k.clientX,l=k.clientY},{passive:!0}),window.addEventListener("touchmove",p=>{if(!i||p.touches.length!==1)return;const k=p.touches[0];H(k.clientX-r,k.clientY-l),r=k.clientX,l=k.clientY},{passive:!0}),window.addEventListener("touchend",()=>i=!1,{passive:!0})}(),e.querySelector("#mmZoomIn").addEventListener("click",o=>K(+B,o.clientX||0,o.clientY||0)),e.querySelector("#mmZoomOut").addEventListener("click",o=>K(-B,o.clientX||0,o.clientY||0)),e.querySelector("#mmZoomReset").addEventListener("click",G);const R=e.querySelector("#mmToggle");R.addEventListener("click",()=>{e.classList.toggle("minimap--collapsed"),R.textContent=e.classList.contains("minimap--collapsed")?"Mở":"Thu"});function Z(){const o=y.nodes.map(i=>`<option value="${ie(i.id)}">${ie(i.label||i.id)}</option>`).join("");I.innerHTML=o,X.innerHTML=o}function a(){E.innerHTML="";for(const o of y.edges){const i=Y(y,o.from),r=Y(y,o.to);if(!i||!r)continue;const l=document.createElement("div");l.className="mm-edge",h(l,i,r),E.appendChild(l)}for(const o of y.nodes){const i=document.createElement("button");i.className="mm-dot",i.type="button",i.dataset.id=o.id,i.style.left=`${o.x}px`,i.style.top=`${o.y}px`,i.title=o.label||o.id,i.addEventListener("click",l=>{l.stopPropagation(),S&&S(o.id)}),E.appendChild(i);const r=document.createElement("div");r.className="mm-label",r.textContent=o.label||o.id,r.style.left=`${o.x+10}px`,r.style.top=`${o.y-6}px`,E.appendChild(r)}b(),F()}function h(o,i,r){const l=i.x,p=i.y,k=r.x,n=r.y,t=k-l,s=n-p,d=Math.hypot(t,s),u=Math.atan2(s,t)*180/Math.PI;o.style.width=`${d}px`,o.style.left=`${l}px`,o.style.top=`${p}px`,o.style.transform=`rotate(${u}deg)`}function b(){E.querySelectorAll(".mm-dot").forEach(o=>{o.dataset.id===$?o.classList.add("mm-dot--active"):o.classList.remove("mm-dot--active")})}function A(o){P();for(let i=0;i<o.length-1;i++){const r=Y(y,o[i]),l=Y(y,o[i+1]);if(!r||!l)continue;const p=document.createElement("div");p.className="mm-edge mm-edge--hl",p.dataset.hl="1",h(p,r,l),E.appendChild(p)}for(const i of o){const r=E.querySelector(`.mm-dot[data-id="${se(i)}"]`);r&&r.classList.add("mm-dot--path")}}function P(){E.querySelectorAll('.mm-edge[data-hl="1"]').forEach(o=>o.remove()),E.querySelectorAll(".mm-dot.mm-dot--path").forEach(o=>o.classList.remove("mm-dot--path"))}e.querySelector("#mmGo").addEventListener("click",async()=>{const o=I.value,i=X.value;if(!o||!i||o===i)return;const r=ae(y,o,i);r.length&&(A(r),f&&await f(r))}),e.querySelector("#mmClear").addEventListener("click",P);function j(o){$=o,Y(y,o)&&(I.value=o,X.value||(X.value=o)),b()}function V(o){y=re(o||y),Z(),a()}async function W(o,i){const r=ae(y,o,i);return r.length?(A(r),f&&await f(r),r):[]}return function(){const i=e.querySelector(".mm-toolbar");let r=!1,l=0,p=0,k=0,n=0;try{const c=JSON.parse(localStorage.getItem("minimap_pos")||"null");c&&Number.isFinite(c.left)&&Number.isFinite(c.top)&&(e.style.left=c.left+"px",e.style.top=c.top+"px",e.style.right="auto",e.style.bottom="auto")}catch{}function t(){const c=e.getBoundingClientRect();localStorage.setItem("minimap_pos",JSON.stringify({left:c.left,top:c.top}))}function s(c,L){if(v)return;const M=(document.activeElement||{}).tagName;if(/INPUT|SELECT|BUTTON|TEXTAREA/.test(M))return;r=!0,e.classList.add("minimap--dragging");const z=e.getBoundingClientRect();k=z.left,n=z.top,l=c,p=L,e.style.position="fixed",e.style.left=k+"px",e.style.top=n+"px",e.style.right="auto",e.style.bottom="auto"}function d(c,L){if(!r)return;const M=c-l,z=L-p,C=window.innerWidth,O=window.innerHeight,ee=e.offsetWidth,de=e.offsetHeight;let te=k+M,ne=n+z;te=Math.min(C-20,Math.max(0-(ee-20),te)),ne=Math.min(O-20,Math.max(0-(de-20),ne)),e.style.left=te+"px",e.style.top=ne+"px"}function u(){r&&(r=!1,e.classList.remove("minimap--dragging"),t())}i.addEventListener("mousedown",c=>s(c.clientX,c.clientY)),window.addEventListener("mousemove",c=>d(c.clientX,c.clientY)),window.addEventListener("mouseup",u),i.addEventListener("touchstart",c=>{if(c.touches.length!==1)return;const L=c.touches[0];s(L.clientX,L.clientY)},{passive:!0}),window.addEventListener("touchmove",c=>{if(!r||c.touches.length!==1)return;const L=c.touches[0];d(L.clientX,L.clientY)},{passive:!0}),window.addEventListener("touchend",u,{passive:!0})}(),Z(),a(),{setActive:j,refresh:V,routeAndPlay:W}}const me=(g,e,m)=>Math.min(m,Math.max(e,g)),ie=g=>String(g).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e]),se=g=>CSS.escape?CSS.escape(g):String(g).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),Y=(g,e)=>g.nodes.find(m=>m.id===e),ce=g=>typeof g=="number"&&Number.isFinite(g),oe=g=>g!=null&&String(g).trim()!=="";function re(g){const e=Array.isArray(g.nodes)?g.nodes.filter(S=>oe(S.id)&&ce(S.x)&&ce(S.y)):[],m=Array.isArray(g.edges)?g.edges.filter(S=>oe(S.from)&&oe(S.to)):[];return{nodes:e,edges:m}}function fe(g){const e=new Map;for(const m of g.nodes)e.set(m.id,[]);for(const m of g.edges){const S=typeof m.w=="number"?m.w:1;e.has(m.from)&&e.has(m.to)&&(e.get(m.from).push({v:m.to,w:S}),e.get(m.to).push({v:m.from,w:S}))}return e}function ae(g,e,m){if(!Y(g,e)||!Y(g,m))return[];const S=fe(g),f=new Map,w=new Map,y=new he;for(const q of g.nodes)f.set(q.id,1/0);for(f.set(e,0),y.push(e,0);!y.empty();){const q=y.pop();if(q===m)break;for(const{v:E,w:N}of S.get(q)||[]){const I=f.get(q)+N;I<f.get(E)&&(f.set(E,I),w.set(E,q),y.push(E,I))}}if(e!==m&&!w.has(m))return[];const $=[];let v=m;for($.push(v);v!==e;){if(v=w.get(v),!v)return[];$.push(v)}return $.reverse()}class he{constructor(){this.h=[]}empty(){return this.h.length===0}push(e,m){this.h.push({k:e,p:m}),this.up(this.h.length-1)}pop(){if(this.h.length===1)return this.h.pop().k;const e=this.h[0].k;return this.h[0]=this.h.pop(),this.down(0),e}up(e){for(;e>0;){const m=e-1>>1;if(this.h[m].p<=this.h[e].p)break;[this.h[m],this.h[e]]=[this.h[e],this.h[m]],e=m}}down(e){for(;;){const m=e*2+1,S=m+1;let f=e;if(m<this.h.length&&this.h[m].p<this.h[f].p&&(f=m),S<this.h.length&&this.h[S].p<this.h[f].p&&(f=S),f===e)break;[this.h[f],this.h[e]]=[this.h[e],this.h[f]],e=f}}}async function pe(g){var k;const{dataBaseUrl:e="./api",rootSelector:m="#pano",fadeSelector:S="#fade",minimapSelector:f="#minimap"}=g||{},w=await fetch(`${e}/scenes`).then(n=>{if(!n.ok)throw new Error("Không tải được scenes.json");return n.json()}),y=document.querySelector(m);if(!y)throw new Error(`Không tìm thấy ${m}`);const $=document.querySelector(S),v=new Marzipano.Viewer(y),q=new Marzipano.EquirectGeometry([{width:4096}]),E=Marzipano.RectilinearView.limit.traditional(Marzipano.util.degToRad(20),Marzipano.util.degToRad(110)),N={};let I={id:null,view:null};const X={scenechange:new Set};function T(n){return X.scenechange.add(n),()=>X.scenechange.delete(n)}function D(n,t){var s;(s=X[n])==null||s.forEach(d=>d(t))}function _(n=1,t=200){if(!$)return Promise.resolve();const s=+getComputedStyle($).opacity||0;return new Promise(d=>{const u=performance.now();(function c(L){const M=Math.min(1,(L-u)/t);$.style.opacity=String(s+(n-s)*M),M<1?requestAnimationFrame(c):d()})(u)})}const B=document.createElement("div");B.className="hs-tip",document.body.appendChild(B);function F(n,t,s){B.innerHTML=n,B.style.left=t+"px",B.style.top=s+"px",B.style.display="block"}function K(n,t){B.style.display!=="none"&&(B.style.left=n+"px",B.style.top=t+"px")}function H(){B.style.display="none",B.innerHTML=""}function G(n,t){var z;const s=document.createElement("div");s.className="hotspot",s.innerHTML=`
      <img class="hotspot-icon" src="${t.icon||"./assets/icon/vitri.png"}" alt="">
      <span>${t.label||t.text||""}</span>
    `;const d=w.find(C=>C.id===t.target),u=t.title||t.label||t.text||((z=d==null?void 0:d.name)==null?void 0:z.vi)||(d==null?void 0:d.name)||t.target,c=t.desc||(d==null?void 0:d.desc)||"",L=t.thumb||(d==null?void 0:d.preview)||"",M=`
      <div class="row">
        ${L?`<img src="${L}" alt="">`:""}
        <div>
          <h4>${u}</h4>
          ${c?`<div class="sub">${c}</div>`:""}
        </div>
      </div>
    `;s.addEventListener("mouseenter",C=>{F(M,C.clientX+8,C.clientY+8)}),s.addEventListener("mousemove",C=>{K(C.clientX+8,C.clientY+8)}),s.addEventListener("mouseleave",()=>{H()}),s.addEventListener("click",async()=>{H(),A==null||A(),await _(1,120),P(t.target),await _(0,120)}),s.addEventListener("touchstart",C=>{C.preventDefault();const O=C.touches[0];B.style.display==="block"?H():F(M,O.clientX+8,O.clientY+8)},{passive:!1}),n.hotspotContainer().createHotspot(s,{yaw:+t.yaw,pitch:+t.pitch}),y.addEventListener("mouseleave",H,{passive:!0})}function U(n){var u,c,L;const t=Marzipano.ImageUrlSource.fromString(n.url||n.src),s=new Marzipano.RectilinearView({yaw:+(((u=n.initialView)==null?void 0:u.yaw)??0),pitch:+(((c=n.initialView)==null?void 0:c.pitch)??0),fov:+(((L=n.initialView)==null?void 0:L.hfov)??1.2)},E),d=v.createScene({source:t,geometry:q,view:s});return(n.hotspots||[]).forEach(G.bind(null,d)),{scene:d,view:s}}function J(n){var d;const t=document.getElementById("tenKhuVuc"),s=w.find(u=>u.id===n);t&&(t.textContent=`Tên khu vực: ${((d=s==null?void 0:s.name)==null?void 0:d.vi)||(s==null?void 0:s.name)||n}`)}const x={on:!1,raf:0,speed:.004},R={timer:0,delay:15e3};function Z(){var t;if(!x.on)return;const n=I.view||((t=v.scene())==null?void 0:t.view());n&&n.setYaw(n.yaw()+x.speed),x.raf=requestAnimationFrame(Z)}function a(){return x.on||(x.on=!0,x.raf||(x.raf=requestAnimationFrame(Z))),!0}function h(){return x.on=!1,x.raf&&(cancelAnimationFrame(x.raf),x.raf=0),!1}function b(){R.timer&&clearTimeout(R.timer),R.timer=setTimeout(()=>{a()},R.delay)}function A(){h(),R.timer&&clearTimeout(R.timer),R.timer=setTimeout(()=>{a()},R.delay)}function P(n){var u;const t=w.find(c=>c.id===n);if(!t)return console.warn("Scene không tồn tại:",n);N[n]||(N[n]=U(t));const{scene:s,view:d}=N[n];s.switchTo(),I={id:n,scene:s,view:d},J(n),(u=l==null?void 0:l.setActive)==null||u.call(l,n),D("scenechange",{id:n,name:(t==null?void 0:t.name)||n}),a()}function j(n=0){var u;const t=I.view||((u=v.scene())==null?void 0:u.view());if(!t)return;const s=Marzipano.util.degToRad(20),d=Marzipano.util.degToRad(110);t.setFov(Math.min(d,Math.max(s,t.fov()+n)))}function V(n=1,t=900){var L;const s=I.view||((L=v.scene())==null?void 0:L.view());if(!s)return;A();const d=.012,u=performance.now();function c(M){return M<.5?2*M*M:1-Math.pow(-2*M+2,2)/2}(function M(z){const C=z-u,O=Math.min(1,C/t),ee=d*c(O<.5?O*2:(1-O)*2);s.setYaw(s.yaw()+n*ee),O<1?requestAnimationFrame(M):b()})(u)}function W(){return(x.on?h():a())||b(),x.on}const o={left:()=>V(-.5),right:()=>V(.5),zoomIn:()=>{A(),j(-.1),b()},zoomOut:()=>{A(),j(.1),b()},toggleAutoRotate:W,isAutoRotating:()=>x.on};(function(){let u=0,c=0,L=!1;function M(){var O;c?(u+=c*35e-5,u=Math.max(-.015,Math.min(.015,u))):u>0?u=Math.max(0,u-6e-4):u<0&&(u=Math.min(0,u+6e-4));const C=I.view||((O=v.scene())==null?void 0:O.view());C&&u&&C.setYaw(C.yaw()+u),L&&requestAnimationFrame(M)}function z(){L||(L=!0,requestAnimationFrame(M))}window.addEventListener("keydown",C=>{C.key==="ArrowLeft"&&(A(),c=-1,z()),C.key==="ArrowRight"&&(A(),c=1,z())},{passive:!0}),window.addEventListener("keyup",C=>{C.key==="ArrowLeft"&&c===-1&&(c=0,b()),C.key==="ArrowRight"&&c===1&&(c=0,b())},{passive:!0})})();const i=document.querySelector(f);async function r(n){console.log("Graph đã thay đổi, đang gửi về server...");try{await fetch(`${e}/graph`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),console.log("Đã lưu vị trí minimap thành công!")}catch(t){console.error("Lỗi khi lưu vị trí minimap:",t)}}const l=i?ue({container:i,graph:await fetch(`${e}/graph`).then(n=>n.ok?n.json():{nodes:[],edges:[]}),onGotoScene:n=>(A(),p(n)),onPathPlay:async n=>{},onGraphChange:r}):null;function p(n){return _(1,120).then(()=>(P(n),_(0,120)))}return P(w[0].id),w&&w.length>0?P(w[0].id):console.error("Không có scene nào để hiển thị."),{navigateTo:p,route:(n,t)=>{var s;return(s=l==null?void 0:l.routeAndPlay)==null?void 0:s.call(l,n,t)},onSceneChange:T,controls:o,getActiveScene:()=>{const n=w.find(t=>t.id===I.id);return{id:I.id,name:(n==null?void 0:n.name)||I.id}},graph:((k=l==null?void 0:l.getGraph)==null?void 0:k.call(l))||null,updateSize:()=>{var n;return(n=v.updateSize)==null?void 0:n.call(v)}}}let Q=null;window.addEventListener("beforeinstallprompt",g=>{g.preventDefault(),Q=g;const e=document.getElementById("installButton");e&&(e.style.display="inline-block")});var le;(le=document.getElementById("installButton"))==null||le.addEventListener("click",async()=>{Q&&(Q.prompt(),await Q.userChoice,Q=null,document.getElementById("installButton").style.display="none")});(async function(){var B,F,K,H,G,U,J,x,R,Z;const e=await pe({dataBaseUrl:"/api",rootSelector:"#pano",minimapSelector:"#minimap",fadeSelector:"#fade"}),m=await fetch("/api/scenes").then(a=>a.json()).catch(()=>[]);let S=localStorage.getItem("lang")||"vi",f={};async function w(a){try{const h=await fetch(`/language/${a}.json`)}catch{}}function y(a,h){const b=document.getElementById("tenKhuVuc");if(!b||!f.sceneLabel)return;const A=(h==null?void 0:h[S])||(h==null?void 0:h.vi)||h||a;b.textContent=`${f.sceneLabel}: ${A}`}(B=document.getElementById("langSwitch"))==null||B.addEventListener("change",a=>{w(a.target.value)}),await w(S);const $=document.getElementById("langSwitch");$&&($.value=S),(F=e.controls)!=null&&F.left&&((K=document.getElementById("left"))==null||K.addEventListener("click",e.controls.left)),(H=e.controls)!=null&&H.right&&((G=document.getElementById("right"))==null||G.addEventListener("click",e.controls.right)),(U=e.controls)!=null&&U.zoomIn&&((J=document.getElementById("zoomIn"))==null||J.addEventListener("click",e.controls.zoomIn)),(x=e.controls)!=null&&x.zoomOut&&((R=document.getElementById("zoomOut"))==null||R.addEventListener("click",e.controls.zoomOut)),(Z=document.getElementById("toggleAutoRotate"))==null||Z.addEventListener("click",()=>{var b;const a=(b=e.controls)!=null&&b.toggleAutoRotate?e.controls.toggleAutoRotate():!1,h=document.getElementById("toggleAutoRotate");h&&(h.textContent=a?f.btnRotateOn||"Dừng lại":f.btnRotateOff||"Tự xoay")}),e.onSceneChange(({id:a,name:h})=>{y(a,h),document.querySelectorAll("#menu li[data-scene]").forEach(A=>A.classList.toggle("active",A.dataset.scene===a))});const v=document.getElementById("menu"),q=document.getElementById("hoverPreview"),E=document.getElementById("previewImage");v&&q&&E&&(v.addEventListener("mouseover",a=>{var b,A;const h=a.target;if((b=h==null?void 0:h.dataset)!=null&&b.scene){const P=((A=m.find(j=>j.id===h.dataset.scene))==null?void 0:A.preview)||"";P&&(E.src=P,q.setAttribute("aria-hidden","false"),q.style.display="block")}}),v.addEventListener("mouseout",()=>{E.src="",q.setAttribute("aria-hidden","true"),q.style.display="none"})),window.addEventListener("resize",()=>{var a;(a=e.updateSize)==null||a.call(e)});const N=document.getElementById("routeFrom"),I=document.getElementById("routeTo"),X=document.getElementById("routeBtn");let T=e==null?void 0:e.graph;if(!T)try{T=await fetch("/api/graph").then(a=>a.json())}catch(a){console.warn("Không tải được graph.json:",a)}T&&N&&I&&(N.innerHTML="",I.innerHTML="",T.nodes.forEach(a=>{const h=document.createElement("option");h.value=a.id,h.textContent=a.label||a.id;const b=h.cloneNode(!0);N.appendChild(h),I.appendChild(b)})),X==null||X.addEventListener("click",()=>{if(!N||!I||!(e!=null&&e.route))return;const a=N.value,h=I.value;!a||!h||a===h||e.route(a,h)});const D=document.getElementById("voiceControlBtn"),_=window.SpeechRecognition||window.webkitSpeechRecognition;if(_){const a=new _;a.continuous=!1,a.lang="vi-VN",a.interimResults=!1,a.maxAlternatives=1;let h=!1;D.addEventListener("click",()=>{if(h){a.stop();return}a.start()}),a.onstart=()=>{h=!0,D.classList.add("listening"),D.textContent="🎧"},a.onend=()=>{h=!1,D.classList.remove("listening"),D.textContent="🎤"},a.onerror=b=>{console.error("Lỗi nhận dạng giọng nói:",b.error)},a.onresult=b=>{var P,j;const A=b.results[0][0].transcript.toLowerCase().trim();console.log("Bạn đã nói:",A);for(const V of m){const W=(((P=V.name)==null?void 0:P.vi)||V.name||"").toLowerCase(),o=(((j=V.name)==null?void 0:j.en)||"").toLowerCase();if(W&&A.includes(W)||o&&A.includes(o)){console.log(`Đã tìm thấy khu vực: "${V.name.vi}". Đang điều hướng...`),e.navigateTo(V.id);return}}console.log("Không tìm thấy khu vực nào khớp.")}}else console.warn("Trình duyệt này không hỗ trợ Web Speech API."),D&&(D.style.display="none")})();
