(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))S(d);new MutationObserver(d=>{for(const T of d)if(T.type==="childList")for(const w of T.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&S(w)}).observe(document,{childList:!0,subtree:!0});function h(d){const T={};return d.integrity&&(T.integrity=d.integrity),d.referrerPolicy&&(T.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?T.credentials="include":d.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function S(d){if(d.ep)return;d.ep=!0;const T=h(d);fetch(d.href,T)}})();function mt(y){const{container:t,graph:h,onGotoScene:S,onPathPlay:d,onGraphChange:T}=y||{};let w=rt(h||{nodes:[],edges:[]}),Y=null,g=!1,P=!1;try{g=JSON.parse(localStorage.getItem("minimap_locked")||"false")}catch{}g&&t.classList.add("locked"),t.classList.add("minimap"),t.innerHTML=`
      <div class="mm-toolbar">
        <div class="mm-route">
          <select id="mmFrom"></select>
          <span>→</span>
          <select id="mmTo"></select>
          <button id="mmGo">Tìm đường</button>
          <button id="mmClear">Xóa</button>
          <button id="mmUnclump">Sắp xếp</button>
        </div>
        <button class="mm-toggle" id="mmToggle">Thu</button>
      </div>
      <div class="mm-viewport" id="mmViewport">
        <div class="mm-stage" id="mmStage"></div>
        <div class="mm-zoom">
          <button id="mmZoomIn">+</button>
          <button id="mmZoomOut">−</button>
          <button id="mmZoomReset">100%</button>
          <button id="mmLock" class="mm-btn-lock">Khoá</button>
        </div>
      </div>
    `,t.querySelector("#mmUnclump").addEventListener("click",()=>{gt(w,{minDist:28,edgeLen:90,iters:80}),u(),dot.setAttribute("draggable","false"),dot.addEventListener("click",i=>{i.stopPropagation(),S&&S(n.id)})});const x=t.querySelector("#mmStage"),q=t.querySelector("#mmViewport"),k=t.querySelector("#mmFrom"),I=t.querySelector("#mmTo");let a={scale:.9,ox:0,oy:0};const X=.5,$=2.5,C=.15;function N(){x.style.transform=`translate(${a.ox}px, ${a.oy}px) scale(${a.scale})`}function D(i,s,c){const b=a.scale,v=ft(b+i,X,$);if(v===b)return;const e=q.getBoundingClientRect(),r=s-e.left,o=c-e.top;a.ox=r-(r-a.ox)*(v/b),a.oy=o-(o-a.oy)*(v/b),a.scale=v,N()}function z(i,s){a.ox+=i,a.oy+=s,N()}function j(){a={scale:1,ox:0,oy:0},N()}function H(i,s){const c=q.getBoundingClientRect(),b=(i-c.left-a.ox)/a.scale,v=(s-c.top-a.oy)/a.scale;return{x:b,y:v}}function K(i){var s;g=!!i,t.classList.toggle("locked",g),(s=document.getElementById("mmLock"))==null||s.classList.toggle("active",g);try{localStorage.setItem("minimap_locked",JSON.stringify(g))}catch{}}const B=t.querySelector("#mmLock");B==null||B.addEventListener("click",()=>K(!g)),B==null||B.classList.toggle("active",g),function(){let s=null,c=0;function b(o,l,f){P=!0,s=o,t.classList.add("minimap--dragging"),v(l,f)}function v(o,l){if(!s)return;const{x:f,y:L}=H(o,l),p=U(w,s);if(!p)return;p.x=Math.round(f),p.y=Math.round(L);const M=x.querySelector(`.mm-dot[data-id="${st(s)}"]`),F=M?M.nextElementSibling:null;M&&(M.style.left=p.x+"px",M.style.top=p.y+"px"),F&&F.classList.contains("mm-label")&&(F.style.left=p.x+10+"px",F.style.top=p.y-6+"px"),c||(c=requestAnimationFrame(()=>{c=0,r()}))}function e(){if(s){s=null,P=!1,t.classList.remove("minimap--dragging");try{localStorage.setItem("graph_draft",JSON.stringify(w))}catch{}T&&T(w)}}x.addEventListener("mousedown",o=>{const l=o.target.closest(".mm-dot");l&&(o.preventDefault(),o.stopPropagation(),b(l.dataset.id,o.clientX,o.clientY))}),window.addEventListener("mousemove",o=>{s&&v(o.clientX,o.clientY)}),window.addEventListener("mouseup",e),x.addEventListener("touchstart",o=>{if(o.touches.length!==1)return;const l=o.target.closest(".mm-dot");if(!l)return;o.preventDefault();const f=o.touches[0];b(l.dataset.id,f.clientX,f.clientY)},{passive:!1}),window.addEventListener("touchmove",o=>{if(!s||o.touches.length!==1)return;const l=o.touches[0];o.preventDefault(),v(l.clientX,l.clientY)},{passive:!1}),window.addEventListener("touchend",e,{passive:!0});function r(){x.querySelectorAll(".mm-edge").forEach(o=>o.remove());for(const o of w.edges){const l=U(w,o.from),f=U(w,o.to);if(!l||!f)continue;const L=document.createElement("div");L.className="mm-edge",m(L,l,f),x.insertBefore(L,x.firstChild)}}}(),q.addEventListener("wheel",i=>{i.preventDefault();const s=i.deltaY>0?-C:C;D(s,i.clientX,i.clientY)},{passive:!1}),function(){let s=!1,c=0,b=0;q.addEventListener("mousedown",v=>{g||P||v.target.closest(".mm-dot")||(s=!0,c=v.clientX,b=v.clientY)}),window.addEventListener("mousemove",v=>{s&&(z(v.clientX-c,v.clientY-b),c=v.clientX,b=v.clientY)}),window.addEventListener("mouseup",()=>s=!1),q.addEventListener("touchstart",v=>{if(g||P||v.touches.length!==1||v.target.closest(".mm-dot"))return;const e=v.touches[0];s=!0,c=e.clientX,b=e.clientY},{passive:!0}),window.addEventListener("touchmove",v=>{if(!s||v.touches.length!==1)return;const e=v.touches[0];z(e.clientX-c,e.clientY-b),c=e.clientX,b=e.clientY},{passive:!0}),window.addEventListener("touchend",()=>s=!1,{passive:!0})}(),t.querySelector("#mmZoomIn").addEventListener("click",i=>D(+C,i.clientX||0,i.clientY||0)),t.querySelector("#mmZoomOut").addEventListener("click",i=>D(-C,i.clientX||0,i.clientY||0)),t.querySelector("#mmZoomReset").addEventListener("click",j);const V=t.querySelector("#mmToggle");V.addEventListener("click",()=>{t.classList.toggle("minimap--collapsed"),V.textContent=t.classList.contains("minimap--collapsed")?"Mở":"Thu"});function G(){const i=w.nodes.map(s=>`<option value="${it(s.id)}">${it(s.label||s.id)}</option>`).join("");k.innerHTML=i,I.innerHTML=i}function u(){x.innerHTML="";for(const i of w.edges){const s=U(w,i.from),c=U(w,i.to);if(!s||!c)continue;const b=document.createElement("div");b.className="mm-edge",m(b,s,c),x.appendChild(b)}for(const i of w.nodes){const s=document.createElement("button");s.className="mm-dot",s.type="button",s.dataset.id=i.id,s.style.left=`${i.x}px`,s.style.top=`${i.y}px`,s.title=i.label||i.id,s.addEventListener("click",b=>{b.stopPropagation(),S&&S(i.id)}),x.appendChild(s);const c=document.createElement("div");c.className="mm-label",c.textContent=i.label||i.id,c.style.left=`${i.x+10}px`,c.style.top=`${i.y-6}px`,x.appendChild(c)}E(),N()}function m(i,s,c){const b=s.x,v=s.y,e=c.x,r=c.y,o=e-b,l=r-v,f=Math.hypot(o,l),L=Math.atan2(l,o)*180/Math.PI;i.style.width=`${f}px`,i.style.left=`${b}px`,i.style.top=`${v}px`,i.style.transform=`rotate(${L}deg)`}function E(){x.querySelectorAll(".mm-dot").forEach(i=>{i.dataset.id===Y?i.classList.add("mm-dot--active"):i.classList.remove("mm-dot--active")})}function A(i){_();for(let s=0;s<i.length-1;s++){const c=U(w,i[s]),b=U(w,i[s+1]);if(!c||!b)continue;const v=document.createElement("div");v.className="mm-edge mm-edge--hl",v.dataset.hl="1",m(v,c,b),x.appendChild(v)}for(const s of i){const c=x.querySelector(`.mm-dot[data-id="${st(s)}"]`);c&&c.classList.add("mm-dot--path")}}function _(){x.querySelectorAll('.mm-edge[data-hl="1"]').forEach(i=>i.remove()),x.querySelectorAll(".mm-dot.mm-dot--path").forEach(i=>i.classList.remove("mm-dot--path"))}t.querySelector("#mmGo").addEventListener("click",async()=>{const i=k.value,s=I.value;if(!i||!s||i===s)return;const c=at(w,i,s);c.length&&(A(c),d&&await d(c))}),t.querySelector("#mmClear").addEventListener("click",_);function O(i){Y=i,U(w,i)&&(k.value=i,I.value||(I.value=i)),E()}function J(i){w=rt(i||w),G(),u()}async function W(i,s){const c=at(w,i,s);return c.length?(A(c),d&&await d(c),c):[]}return function(){const s=t.querySelector(".mm-toolbar");let c=!1,b=0,v=0,e=0,r=0;try{const p=JSON.parse(localStorage.getItem("minimap_pos")||"null");p&&Number.isFinite(p.left)&&Number.isFinite(p.top)&&(t.style.left=p.left+"px",t.style.top=p.top+"px",t.style.right="auto",t.style.bottom="auto")}catch{}function o(){const p=t.getBoundingClientRect();localStorage.setItem("minimap_pos",JSON.stringify({left:p.left,top:p.top}))}function l(p,M){if(g)return;const F=(document.activeElement||{}).tagName;if(/INPUT|SELECT|BUTTON|TEXTAREA/.test(F))return;c=!0,t.classList.add("minimap--dragging");const R=t.getBoundingClientRect();e=R.left,r=R.top,b=p,v=M,t.style.position="fixed",t.style.left=e+"px",t.style.top=r+"px",t.style.right="auto",t.style.bottom="auto"}function f(p,M){if(!c)return;const F=p-b,R=M-v,Z=window.innerWidth,tt=window.innerHeight,dt=t.offsetWidth,ut=t.offsetHeight;let et=e+F,nt=r+R;et=Math.min(Z-20,Math.max(0-(dt-20),et)),nt=Math.min(tt-20,Math.max(0-(ut-20),nt)),t.style.left=et+"px",t.style.top=nt+"px"}function L(){c&&(c=!1,t.classList.remove("minimap--dragging"),o())}s.addEventListener("mousedown",p=>l(p.clientX,p.clientY)),window.addEventListener("mousemove",p=>f(p.clientX,p.clientY)),window.addEventListener("mouseup",L),s.addEventListener("touchstart",p=>{if(p.touches.length!==1)return;const M=p.touches[0];l(M.clientX,M.clientY)},{passive:!0}),window.addEventListener("touchmove",p=>{if(!c||p.touches.length!==1)return;const M=p.touches[0];f(M.clientX,M.clientY)},{passive:!0}),window.addEventListener("touchend",L,{passive:!0})}(),G(),u(),{setActive:O,refresh:J,routeAndPlay:W}}const ft=(y,t,h)=>Math.min(h,Math.max(t,y)),it=y=>String(y).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t]),st=y=>CSS.escape?CSS.escape(y):String(y).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),U=(y,t)=>y.nodes.find(h=>h.id===t),ct=y=>typeof y=="number"&&Number.isFinite(y),ot=y=>y!=null&&String(y).trim()!=="";function rt(y){const t=Array.isArray(y.nodes)?y.nodes.filter(S=>ot(S.id)&&ct(S.x)&&ct(S.y)):[],h=Array.isArray(y.edges)?y.edges.filter(S=>ot(S.from)&&ot(S.to)):[];return{nodes:t,edges:h}}function ht(y){const t=new Map;for(const h of y.nodes)t.set(h.id,[]);for(const h of y.edges){const S=typeof h.w=="number"?h.w:1;t.has(h.from)&&t.has(h.to)&&(t.get(h.from).push({v:h.to,w:S}),t.get(h.to).push({v:h.from,w:S}))}return t}function at(y,t,h){if(!U(y,t)||!U(y,h))return[];const S=ht(y),d=new Map,T=new Map,w=new pt;for(const P of y.nodes)d.set(P.id,1/0);for(d.set(t,0),w.push(t,0);!w.empty();){const P=w.pop();if(P===h)break;for(const{v:x,w:q}of S.get(P)||[]){const k=d.get(P)+q;k<d.get(x)&&(d.set(x,k),T.set(x,P),w.push(x,k))}}if(t!==h&&!T.has(h))return[];const Y=[];let g=h;for(Y.push(g);g!==t;){if(g=T.get(g),!g)return[];Y.push(g)}return Y.reverse()}class pt{constructor(){this.h=[]}empty(){return this.h.length===0}push(t,h){this.h.push({k:t,p:h}),this.up(this.h.length-1)}pop(){if(this.h.length===1)return this.h.pop().k;const t=this.h[0].k;return this.h[0]=this.h.pop(),this.down(0),t}up(t){for(;t>0;){const h=t-1>>1;if(this.h[h].p<=this.h[t].p)break;[this.h[h],this.h[t]]=[this.h[t],this.h[h]],t=h}}down(t){for(;;){const h=t*2+1,S=h+1;let d=t;if(h<this.h.length&&this.h[h].p<this.h[d].p&&(d=h),S<this.h.length&&this.h[S].p<this.h[d].p&&(d=S),d===t)break;[this.h[d],this.h[t]]=[this.h[t],this.h[d]],t=d}}}function gt(y,t={}){const h=t.minDist??28,S=t.edgeLen??90,d=t.iters??80,T=t.kRep??.45,w=t.kAtt??.02,Y=t.damp??.85,g=y.nodes,P=new Map(g.map((I,a)=>[I.id,a])),x=Array.from({length:g.length},I=>[]);for(const I of y.edges){const a=P.get(I.from),X=P.get(I.to);a==null||X==null||(x[a].push(X),x[X].push(a))}const q=new Array(g.length).fill(0),k=new Array(g.length).fill(0);for(let I=0;I<d;I++){for(let a=0;a<g.length;a++){const X=g[a];if(!(!isFinite(X.x)||!isFinite(X.y)))for(let $=a+1;$<g.length;$++){const C=g[$];if(!isFinite(C.x)||!isFinite(C.y))continue;let N=X.x-C.x,D=X.y-C.y,z=N*N+D*D;z===0&&(N=(Math.random()-.5)*.01,D=(Math.random()-.5)*.01,z=N*N+D*D);const j=Math.sqrt(z);if(j<h){const H=(h-j)*T,K=N/j,B=D/j;q[a]+=K*H,k[a]+=B*H,q[$]-=K*H,k[$]-=B*H}}}for(let a=0;a<g.length;a++){const X=g[a];for(const $ of x[a]){if($<=a)continue;const C=g[$];let N=C.x-X.x,D=C.y-X.y;const z=Math.hypot(N,D)||1e-4,j=(z-S)*w,H=N/z,K=D/z;q[a]+=H*j,k[a]+=K*j,q[$]-=H*j,k[$]-=K*j}}for(let a=0;a<g.length;a++)g[a].x+=q[a],g[a].y+=k[a],q[a]*=Y,k[a]*=Y}for(const I of g)I.x=Math.round(I.x),I.y=Math.round(I.y);return y}async function yt(y){var v;const{dataBaseUrl:t="./data",rootSelector:h="#pano",fadeSelector:S="#fade",minimapSelector:d="#minimap"}=y||{},T=await fetch(`${t}/scenes.json`).then(e=>{if(!e.ok)throw new Error("Không tải được scenes.json");return e.json()}),w=document.querySelector(h);if(!w)throw new Error(`Không tìm thấy ${h}`);const Y=document.querySelector(S),g=new Marzipano.Viewer(w),P=new Marzipano.EquirectGeometry([{width:4096}]),x=Marzipano.RectilinearView.limit.traditional(Marzipano.util.degToRad(20),Marzipano.util.degToRad(110)),q={};let k={id:null,view:null};const I={scenechange:new Set};function a(e){return I.scenechange.add(e),()=>I.scenechange.delete(e)}function X(e,r){var o;(o=I[e])==null||o.forEach(l=>l(r))}function $(e=1,r=200){if(!Y)return Promise.resolve();const o=+getComputedStyle(Y).opacity||0;return new Promise(l=>{const f=performance.now();(function L(p){const M=Math.min(1,(p-f)/r);Y.style.opacity=String(o+(e-o)*M),M<1?requestAnimationFrame(L):l()})(f)})}const C=document.createElement("div");C.className="hs-tip",document.body.appendChild(C);function N(e,r,o){C.innerHTML=e,C.style.left=r+"px",C.style.top=o+"px",C.style.display="block"}function D(e,r){C.style.display!=="none"&&(C.style.left=e+"px",C.style.top=r+"px")}function z(){C.style.display="none",C.innerHTML=""}function j(e,r){var F;const o=document.createElement("div");o.className="hotspot",o.innerHTML=`
      <img class="hotspot-icon" src="${r.icon||"./assets/icon/vitri.png"}" alt="">
      <span>${r.label||r.text||""}</span>
    `;const l=T.find(R=>R.id===r.target),f=r.title||r.label||r.text||((F=l==null?void 0:l.name)==null?void 0:F.vi)||(l==null?void 0:l.name)||r.target,L=r.desc||(l==null?void 0:l.desc)||"",p=r.thumb||(l==null?void 0:l.preview)||"",M=`
      <div class="row">
        ${p?`<img src="${p}" alt="">`:""}
        <div>
          <h4>${f}</h4>
          ${L?`<div class="sub">${L}</div>`:""}
        </div>
      </div>
    `;o.addEventListener("mouseenter",R=>{N(M,R.clientX+8,R.clientY+8)}),o.addEventListener("mousemove",R=>{D(R.clientX+8,R.clientY+8)}),o.addEventListener("mouseleave",()=>{z()}),o.addEventListener("click",async()=>{z(),A==null||A(),await $(1,120),_(r.target),await $(0,120)}),o.addEventListener("touchstart",R=>{R.preventDefault();const Z=R.touches[0];C.style.display==="block"?z():N(M,Z.clientX+8,Z.clientY+8)},{passive:!1}),e.hotspotContainer().createHotspot(o,{yaw:+r.yaw,pitch:+r.pitch}),w.addEventListener("mouseleave",z,{passive:!0})}function H(e){var f,L,p;const r=Marzipano.ImageUrlSource.fromString(e.url||e.src),o=new Marzipano.RectilinearView({yaw:+(((f=e.initialView)==null?void 0:f.yaw)??0),pitch:+(((L=e.initialView)==null?void 0:L.pitch)??0),fov:+(((p=e.initialView)==null?void 0:p.hfov)??1.2)},x),l=g.createScene({source:r,geometry:P,view:o});return(e.hotspots||[]).forEach(j.bind(null,l)),{scene:l,view:o}}function K(e){var l;const r=document.getElementById("tenKhuVuc"),o=T.find(f=>f.id===e);r&&(r.textContent=`Tên khu vực: ${((l=o==null?void 0:o.name)==null?void 0:l.vi)||(o==null?void 0:o.name)||e}`)}const B={on:!1,raf:0,speed:.004},V={timer:0,delay:15e3};function G(){var r;if(!B.on)return;const e=k.view||((r=g.scene())==null?void 0:r.view());e&&e.setYaw(e.yaw()+B.speed),B.raf=requestAnimationFrame(G)}function u(){return B.on||(B.on=!0,B.raf||(B.raf=requestAnimationFrame(G))),!0}function m(){return B.on=!1,B.raf&&(cancelAnimationFrame(B.raf),B.raf=0),!1}function E(){V.timer&&clearTimeout(V.timer),V.timer=setTimeout(()=>{u()},V.delay)}function A(){m(),V.timer&&clearTimeout(V.timer),V.timer=setTimeout(()=>{u()},V.delay)}function _(e){var f;const r=T.find(L=>L.id===e);if(!r)return console.warn("Scene không tồn tại:",e);q[e]||(q[e]=H(r));const{scene:o,view:l}=q[e];o.switchTo(),k={id:e,scene:o,view:l},K(e),(f=c==null?void 0:c.setActive)==null||f.call(c,e),X("scenechange",{id:e,name:(r==null?void 0:r.name)||e}),u()}function O(e=0){var f;const r=k.view||((f=g.scene())==null?void 0:f.view());if(!r)return;const o=Marzipano.util.degToRad(20),l=Marzipano.util.degToRad(110);r.setFov(Math.min(l,Math.max(o,r.fov()+e)))}function J(e=1,r=900){var p;const o=k.view||((p=g.scene())==null?void 0:p.view());if(!o)return;A();const l=.012,f=performance.now();function L(M){return M<.5?2*M*M:1-Math.pow(-2*M+2,2)/2}(function M(F){const R=F-f,Z=Math.min(1,R/r),tt=l*L(Z<.5?Z*2:(1-Z)*2);o.setYaw(o.yaw()+e*tt),Z<1?requestAnimationFrame(M):E()})(f)}function W(){return(B.on?m():u())||E(),B.on}const i={left:()=>J(-.5),right:()=>J(.5),zoomIn:()=>{A(),O(-.1),E()},zoomOut:()=>{A(),O(.1),E()},toggleAutoRotate:W,isAutoRotating:()=>B.on};(function(){let f=0,L=0,p=!1;function M(){var Z;L?(f+=L*35e-5,f=Math.max(-.015,Math.min(.015,f))):f>0?f=Math.max(0,f-6e-4):f<0&&(f=Math.min(0,f+6e-4));const R=k.view||((Z=g.scene())==null?void 0:Z.view());R&&f&&R.setYaw(R.yaw()+f),p&&requestAnimationFrame(M)}function F(){p||(p=!0,requestAnimationFrame(M))}window.addEventListener("keydown",R=>{R.key==="ArrowLeft"&&(A(),L=-1,F()),R.key==="ArrowRight"&&(A(),L=1,F())},{passive:!0}),window.addEventListener("keyup",R=>{R.key==="ArrowLeft"&&L===-1&&(L=0,E()),R.key==="ArrowRight"&&L===1&&(L=0,E())},{passive:!0})})();const s=document.querySelector(d),c=s?mt({container:s,graph:await(async()=>{try{return await fetch(`${t}/graph.json`).then(r=>r.ok?r.json():null)||{nodes:[],edges:[]}}catch{return{nodes:[],edges:[]}}})(),onGotoScene:e=>(A(),b(e)),onPathPlay:async e=>{for(const r of e)A(),await $(1,80),_(r),await $(0,80),await new Promise(o=>setTimeout(o,60))}}):null;function b(e){return $(1,120).then(()=>(_(e),$(0,120)))}return _(T[0].id),{navigateTo:b,route:(e,r)=>{var o;return(o=c==null?void 0:c.routeAndPlay)==null?void 0:o.call(c,e,r)},onSceneChange:a,controls:i,getActiveScene:()=>{const e=T.find(r=>r.id===k.id);return{id:k.id,name:(e==null?void 0:e.name)||k.id}},graph:((v=c==null?void 0:c.getGraph)==null?void 0:v.call(c))||null,updateSize:()=>{var e;return(e=g.updateSize)==null?void 0:e.call(g)}}}let Q=null;window.addEventListener("beforeinstallprompt",y=>{y.preventDefault(),Q=y;const t=document.getElementById("installButton");t&&(t.style.display="inline-block")});var lt;(lt=document.getElementById("installButton"))==null||lt.addEventListener("click",async()=>{Q&&(Q.prompt(),await Q.userChoice,Q=null,document.getElementById("installButton").style.display="none")});(async function(){var C,N,D,z,j,H,K,B,V,G;const t=await yt({dataBaseUrl:"/data",rootSelector:"#pano",minimapSelector:"#minimap",fadeSelector:"#fade"}),h=await fetch("/data/scenes.json").then(u=>u.json()).catch(()=>[]);let S=localStorage.getItem("lang")||"vi",d={};async function T(u){var m;try{const E=await fetch(`/language/${u}.json`);if(!E.ok)throw new Error(`${E.status} ${E.statusText}`);d=await E.json(),S=u,localStorage.setItem("lang",u),w(),g();const A=(m=t.getActiveScene)==null?void 0:m.call(t);A&&Y(A.id,A.name)}catch(E){console.error("i18n load fail:",E)}}function w(){const u=document.getElementById("tieude");u&&d.title&&(u.textContent=d.title);const m=document.getElementById("toggleAutoRotate");if(m&&d.btnRotateOn&&d.btnRotateOff){const A=t.controls||{},_=typeof A.isAutoRotating=="function"?A.isAutoRotating():typeof A.isAutoRotating=="boolean"?A.isAutoRotating:!1;m.textContent=_?d.btnRotateOn:d.btnRotateOff}const E=document.getElementById("routeBtn");E&&d.routeBtn&&(E.textContent=d.routeBtn)}function Y(u,m){const E=document.getElementById("tenKhuVuc");if(!E||!d.sceneLabel)return;const A=(m==null?void 0:m[S])||(m==null?void 0:m.vi)||m||u;E.textContent=`${d.sceneLabel}: ${A}`}function g(){var A,_;const u=document.getElementById("menu");if(!u)return;u.innerHTML="";const m=document.createElement("button");m.id="menuButton",m.setAttribute("aria-expanded","false"),m.textContent="☰";const E=document.createElement("ul");E.id="menuList";for(const O of h){const J=document.createElement("li");J.dataset.scene=O.id,J.textContent=((A=O==null?void 0:O.name)==null?void 0:A[S])||((_=O==null?void 0:O.name)==null?void 0:_.vi)||O.id,J.addEventListener("click",()=>t.navigateTo(O.id)),E.appendChild(J)}m.addEventListener("click",()=>{const O=m.getAttribute("aria-expanded")==="true";m.setAttribute("aria-expanded",String(!O)),E.style.display=O?"none":"block"}),u.appendChild(m),u.appendChild(E)}(C=document.getElementById("langSwitch"))==null||C.addEventListener("change",u=>{T(u.target.value)}),await T(S);const P=document.getElementById("langSwitch");P&&(P.value=S),(N=t.controls)!=null&&N.left&&((D=document.getElementById("left"))==null||D.addEventListener("click",t.controls.left)),(z=t.controls)!=null&&z.right&&((j=document.getElementById("right"))==null||j.addEventListener("click",t.controls.right)),(H=t.controls)!=null&&H.zoomIn&&((K=document.getElementById("zoomIn"))==null||K.addEventListener("click",t.controls.zoomIn)),(B=t.controls)!=null&&B.zoomOut&&((V=document.getElementById("zoomOut"))==null||V.addEventListener("click",t.controls.zoomOut)),(G=document.getElementById("toggleAutoRotate"))==null||G.addEventListener("click",()=>{var E;const u=(E=t.controls)!=null&&E.toggleAutoRotate?t.controls.toggleAutoRotate():!1,m=document.getElementById("toggleAutoRotate");m&&(m.textContent=u?d.btnRotateOn||"Dừng lại":d.btnRotateOff||"Tự xoay")}),t.onSceneChange(({id:u,name:m})=>{Y(u,m),document.querySelectorAll("#menu li[data-scene]").forEach(A=>A.classList.toggle("active",A.dataset.scene===u))});const x=document.getElementById("menu"),q=document.getElementById("hoverPreview"),k=document.getElementById("previewImage");x&&q&&k&&(x.addEventListener("mouseover",u=>{var E,A;const m=u.target;if((E=m==null?void 0:m.dataset)!=null&&E.scene){const _=((A=h.find(O=>O.id===m.dataset.scene))==null?void 0:A.preview)||"";_&&(k.src=_,q.setAttribute("aria-hidden","false"),q.style.display="block")}}),x.addEventListener("mouseout",()=>{k.src="",q.setAttribute("aria-hidden","true"),q.style.display="none"})),window.addEventListener("resize",()=>{var u;(u=t.updateSize)==null||u.call(t)});const I=document.getElementById("routeFrom"),a=document.getElementById("routeTo"),X=document.getElementById("routeBtn");let $=t==null?void 0:t.graph;if(!$)try{$=await fetch("/data/graph.json").then(u=>u.json())}catch(u){console.warn("Không tải được graph.json:",u)}$&&I&&a&&(I.innerHTML="",a.innerHTML="",$.nodes.forEach(u=>{const m=document.createElement("option");m.value=u.id,m.textContent=u.label||u.id;const E=m.cloneNode(!0);I.appendChild(m),a.appendChild(E)})),X==null||X.addEventListener("click",()=>{if(!I||!a||!(t!=null&&t.route))return;const u=I.value,m=a.value;!u||!m||u===m||t.route(u,m)})})();
